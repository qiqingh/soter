. ../../../.config

echo "  <?"
echo "  /* vi: set sw=4 ts=4: */"
echo "  require(\"/etc/templates/troot.php\");"
echo "  "
echo "  \$klog_pid=\"/var/run/klogd.pid\";"
echo "  \$lanif=query(\"/runtime/layout/lanif\");"
echo "  \$wanif=query(\"/runtime/wan/inf:1/interface\");"
echo "  if (\$wanif==\"\") { \$wanif=query(\"/runtime/layout/wanif\"); }"
echo "  /*syslogd_2007_01_23 , Jordan start */"
echo "  \$loglevel=query(\"/security/log/loglevel\");"
echo "  \$first_init=query(\"/runtime/log/first_init\");"
echo "  \$First_init_RemoLog=query(\"/runtime/log/Remote_log_init\");"
echo "  \$fw_ver=query(\"/runtime/sys/info/firmwareversion\");"
echo "  /*syslogd_2007_01_23 , Jordan end*/"
echo "  \$remoteInfo=query(\"/security/log/remoteInfo\");/*RemoteLog_2007_02_15, Jordan */"
echo "  \$smtpInfo=query(\"/security/log/smtpInfo\");/*smtp_2007_02_16, Jordan*/"
echo "  if (\$klogd_only != 1)"
echo "  echo \"if [ -f \".\$klog_pid.\" ]; then\n\";"
echo "  echo \"	PID=\`cat \".\$klog_pid.\"\`\n\";"
echo "  echo \"	if [ \$PID != 0 ]; then\n\";"
echo "  echo \"		kill \$PID > /dev/console 2>&1\n\";"
echo "  echo \"	fi\n\";"
echo "  echo \"	rm -f \".\$klog_pid.\"\n\";"
echo "  echo \"fi\n\";"
echo "  /*klogd_2007_01_30 , Jordan start */"
echo "  \$opts=\"\";"
echo "  /*syslog_2007_02_16 , Jordan marked*/"
echo "  /*if (\$first_init == 1) { \$opts=\$opts.\" -b \".\$fw_ver; }*//*ap71_syslogd_20061125*//*Added by Erick*/"
echo "  "
echo "  if (\$loglevel != \"\")"
echo "  {echo \"klogd -c \".\$loglevel.\" \".\$opts.\" &\n\";}"
echo "  else"
echo "  {echo \"klogd -c 5 \".\$opts.\" &\n\";}"
echo "  echo \"echo \$! > \".\$klog_pid.\"\n\";"
echo "  echo \"rgdb -s /security/log/first_init 0\n\";"
echo "  /*"
echo "  echo \"klogd -l \".\$lanif.\" -w \".\$wanif.\" &\n\";"
echo "  echo \"echo \$! > \".\$klog_pid.\"\n\";"
echo "  */"
echo "  /*klogd_2007_01_30 , Jordan end*/"
echo "  ?>"

